{% extends "governance/base.html" %}
{% load static %}

{% block title %}AI Inventory{% endblock %}

{% block dashboard_content %}
<div class="flex flex-col gap-5">
    <!-- Breadcrumb Navigation -->
    <div class="flex items-center gap-3">
        <button class="w-6 h-6 bg-transparent border-none cursor-pointer p-0 flex items-center justify-center" onclick="history.back()">
            <img src="{% static 'governance/img/arrow-left.svg' %}" alt="Back" class="w-3.5 h-3.5">
        </button>
        <button class="w-6 h-6 bg-transparent border-none cursor-pointer p-0 flex items-center justify-center" onclick="history.forward()">
            <img src="{% static 'governance/img/arrow-right-gray.svg' %}" alt="Forward" class="w-3.5 h-3.5">
        </button>
        <span class="text-sm font-semibold text-[#F13D30]">AI Inventory</span>
    </div>

    <!-- Page Header -->
    <div class="flex justify-between items-start">
        <div>
            <h1 class="text-2xl font-bold text-[#22262A] mb-1">AI Systems</h1>
        </div>
        <div class="flex items-center gap-3">
            <button class="flex items-center gap-1 px-4 py-2 border border-[#F13D30] bg-white rounded-lg text-sm font-semibold text-[#F13D30] cursor-pointer transition-all duration-200 hover:bg-[#FEF5F4]">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                <span>Import</span>
            </button>
            <button class="flex items-center gap-1 px-4 py-2 border border-[#F13D30] bg-white rounded-lg text-sm font-semibold text-[#F13D30] cursor-pointer transition-all duration-200 hover:bg-[#FEF5F4]">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                <span>Export</span>
            </button>
        </div>
    </div>

    <!-- Alert Banner -->
    {% if systems_need_attention > 0 %}
    <div class="flex items-start gap-3 p-4 bg-[#FEF2F2] border-l-4 border-[#F13D30] rounded-lg">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-5 h-5 text-[#F13D30]">
            <circle cx="12" cy="12" r="10" />
            <path d="M12 16v-4M12 8h.01" />
        </svg>
        <div class="flex-1">
            <p class="text-sm font-semibold text-[#111827] mb-1">{{ systems_need_attention }} systems need attention</p>
            <p class="text-sm text-[#6B7280]">Complete the compliance assessment for systems with "Not started" or "In progress" status</p>
        </div>
    </div>
    {% endif %}

    <!-- Action Controls & Search -->
    <div class="flex items-center justify-between gap-4">
        <!-- Left: Add New Button -->
        <div class="flex items-center">
            <button onclick="openAddSystemModal()" class="flex items-center gap-2 px-4 py-2 bg-[#F13D30] text-white text-sm font-medium rounded-lg hover:bg-[#d63529] transition-colors">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                <span>Add New</span>
            </button>
        </div>
        <!-- Right: Search, Filter, Sort -->
        <div class="flex items-center gap-3">
            <div class="relative flex-1 max-w-md">
                <input type="text" id="search-input" placeholder="Search AI systems..." 
                    class="w-full px-4 py-2 pl-10 border border-[#D1D5DB] rounded-lg text-sm text-[#374151] bg-white focus:outline-none focus:ring-2 focus:ring-[#F13D30]">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 text-[#9CA3AF]">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="m21 21-4.35-4.35"></path>
                </svg>
            </div>
            <button class="flex items-center gap-2 px-4 py-2 border border-[#D1D5DB] bg-white text-[#374151] text-sm font-medium rounded-lg hover:bg-[#F9FAFB] transition-colors">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4 text-[#374151]">
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                </svg>
                <span>Filter</span>
            </button>
            <button class="flex items-center gap-2 px-4 py-2 border border-[#D1D5DB] bg-white text-[#374151] text-sm font-medium rounded-lg hover:bg-[#F9FAFB] transition-colors">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4 text-[#374151]">
                    <path d="M3 6h18M7 12h10M11 18h2"></path>
                </svg>
                <span>Sort</span>
            </button>
        </div>
    </div>

    <!-- Tip Banner -->
    <div class="flex items-start gap-3 p-4 bg-[#EFF6FF] border-l-4 border-[#3B82F6] rounded-lg">
        <span class="text-sm font-semibold text-[#3B82F6]">> Tip:</span>
        <p class="text-sm text-[#6B7280]">Click on any row to view details and update information</p>
    </div>

    <!-- AI Systems Table -->
    <div class="bg-white rounded-lg border border-[#E5E7EB] shadow-sm overflow-hidden">
        <table class="w-full">
            <thead class="bg-[#F9FAFB] border-b border-[#E5E7EB]">
                <tr>
                    <th class="px-4 py-4 text-left text-xs font-semibold text-[#6B7280] uppercase tracking-wider">AI SYSTEM NAME</th>
                    <th class="px-4 py-4 text-left text-xs font-semibold text-[#6B7280] uppercase tracking-wider">OWNER</th>
                    <th class="px-4 py-4 text-left text-xs font-semibold text-[#6B7280] uppercase tracking-wider">STATUS</th>
                    <th class="px-4 py-4 text-left text-xs font-semibold text-[#6B7280] uppercase tracking-wider">ROLE</th>
                    <th class="px-4 py-4 text-left text-xs font-semibold text-[#6B7280] uppercase tracking-wider">RISK CLASSIFICATION</th>
                    <th class="px-4 py-4 text-left text-xs font-semibold text-[#6B7280] uppercase tracking-wider">COMPLIANCE STATUS</th>
                    <th class="px-4 py-4 text-left text-xs font-semibold text-[#6B7280] uppercase tracking-wider">LAST UPDATED</th>
                    <th class="px-4 py-4 text-left text-xs font-semibold text-[#6B7280] uppercase tracking-wider">PROVIDER TYPE</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-[#E5E7EB]">
                {% for system in ai_systems %}
                <tr class="hover:bg-[#F9FAFB] cursor-pointer system-row" data-agent-id="{{ system.id }}">
                    <td class="px-4 py-5">
                        <div class="flex items-center gap-2">
                            <span class="text-sm font-medium text-[#111827]">{{ system.name }}</span>
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-4 h-4 text-[#9CA3AF]">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </div>
                    </td>
                    <td class="px-4 py-5 text-sm text-[#374151]">{{ system.owner|default:"â€”" }}</td>
                    <td class="px-4 py-5">
                        <span class="px-2 py-1 text-xs font-medium rounded-full {{ system.status_badge_class }}">
                            {{ system.status }}
                        </span>
                    </td>
                    <td class="px-4 py-5 text-sm text-[#374151]">{{ system.role }}</td>
                    <td class="px-4 py-5">
                        <span class="px-2 py-1 text-xs font-medium rounded-full {{ system.risk_badge_class }}">
                            {{ system.risk_classification }}
                        </span>
                    </td>
                    <td class="px-4 py-5">
                        <span class="px-2 py-1 text-xs font-medium rounded-full {{ system.compliance_badge_class }}">
                            {{ system.compliance_status }}
                        </span>
                    </td>
                    <td class="px-4 py-5 text-sm text-[#374151]">{{ system.last_updated }}</td>
                    <td class="px-4 py-5 text-sm text-[#374151]">{{ system.provider_type }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="px-4 py-8 text-center text-sm text-[#6B7280]">No AI systems found</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div class="flex items-center justify-between">
        <p class="text-sm text-[#6B7280]">Showing {{ ai_systems|length }} AI systems</p>
        <div class="flex items-center gap-2">
            <button class="px-3 py-1.5 text-sm font-medium text-[#374151] border border-[#D1D5DB] rounded-lg hover:bg-[#F9FAFB] transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>Previous</button>
            <button class="px-3 py-1.5 text-sm font-medium text-white bg-[#F13D30] rounded-lg">1</button>
            <button class="px-3 py-1.5 text-sm font-medium text-[#374151] border border-[#D1D5DB] rounded-lg hover:bg-[#F9FAFB] transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>Next</button>
        </div>
    </div>
</div>

<script>
function openAddSystemModal() {
    // TODO: Implement add system modal
    alert('Add New System functionality coming soon');
}

function viewSystemDetails(agentId) {
    window.location.href = '{% url "ai_system_detail" 0 %}'.replace('0', agentId);
}

// Row click handler
document.querySelectorAll('.system-row').forEach(row => {
    row.addEventListener('click', function() {
        const agentId = this.getAttribute('data-agent-id');
        if (agentId) {
            viewSystemDetails(agentId);
        }
    });
});

// Search functionality
document.getElementById('search-input')?.addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('tbody tr');
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
    });
});
</script>
{% endblock %}
